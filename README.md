# Облачное хранилище файлов

Многопользовательское файловое облако. Пользователи сервиса могут использовать его для загрузки и хранения файлов. Источником вдохновения для проекта является Google Drive.

## Технологический стек

- Spring Boot, Spring Security, Spring Data JPA
- PostgreSQL, Minio
- Thymeleaf, HTML/CSS, Bootstrap
- Docker, Docker Compose
- JUnit, Testcontainers
- Tomcat
- Maven

## Функционал приложения

Работа с пользователями:
- Регистрация
- Авторизация
- Logout

Работа с файлами и папками:
- Загрузка файлов и папок
- Создание новой пустой папки (аналогично созданию новой папки в проводнике)
- Удаление
- Переименование

## Интерфейс приложения

### Главная страница

Адрес - `/?path=$path_to_subdirectory`. Параметр `$path` задаёт путь просматриваемой папки. Если параметр отсутствует, подразумевается корневая папка. Пример - `/path=Projects%2FJava%2FCloudFileStorage` (параметр закодирован через URL Encode).

- Заголовок
    - Для неавторизованных пользователей - кнопки регистрации и авторизации
    - Для авторизованных пользователей - логин текущего пользователя и кнопка Logout
- Контент (только для авторизованных пользователей)
    - Форма поиска файлов и папок по названию
    - Навигационная цепочка (breadcrumbs), содержащая путь из папок до текущей папки. Каждый элемент является ссылкой на свою папку. Пример - цепочка из папок, ведущая к - `Projects/Java/CloudFileStorage` содержала бы 3 папки - корневую, `Projects` и `Projects/Java`
    - Список файлов в текущей директории. Для каждого файла отображаем имя и кнопку, вызывающее меню действий (удаление, переименование)
    - Формы (или drop areas) для загрузки файлов и папок

### Страница поиска файлов

Адрес - `/search/?query=$search_query`.

- Заголовок
    - Для неавторизованных пользователей - кнопки регистрации и авторизации
    - Для авторизованных пользователей - логин текущего пользователя и кнопка Logout
- Контент
    - Форма поиска файлов и папок по названию
    - Список найденных файлов. Для каждого найденного файла отображаем имя и кнопку для перехода в папку, содержащую данный файл

Неавторизованные пользователя не имеют доступа к данной странице, приложение должно редиректить их на форму авторизации.

### Контроллер для доступа к конкретному файлу

### Остальное

- Страницы с формами регистрации и авторизации

## Работа с сессиями, авторизацией, регистрацией

За авторизацию, управление доступом к страницам отвечает Spring Security.

За работу с сессиями отвечает Spring Sessions. По умолчанию Spring Boot хранит сессии внутри приложения, и они теряются после каждого перезапуска приложения. Мы воспользуемся Redis для хранения сессий. Пример - [https://www.baeldung.com/spring-session](https://www.baeldung.com/spring-session). Redis - NoSQL хранилище, имеющее встроенный TTL (time to live) атрибут для записей, что делает его удобным для хранения сессий - истекшие сессии автоматически удаляются. 

## База данных

Раздел в процессе разработки

## Хранилище файлов S3

Для хранения файлов будем пользоваться S3 - simple storage service. Проект, разработанный Amazon Cloud Services, представляет из себя облачный сервис и протокол для файлового хранилища. Чтобы не зависеть от платных сервисов Amazon в этом проекте, воспользуемся альтернативным S3-совместимым хранилищем, которое можно запустить локально - [https://min.io/](https://min.io/)

### Структура S3 хранилища

Для хранения файлов всех пользователей в проекте используется бакет под названием `files`. В корне бакета для каждого пользователя будет создана папка с именем в формате `${id}`, где `id` является идентификатором пользователя из PostgreSQL.

Каждая из таких папок является корнем для хранения папок данного пользователя. Пример - файл `docs/test.txt` пользователя с id `1` должен быть сохранён в путь `1/docs/test.txt`.

### Работа с S3 из Java

Для работы с S3 используется MinIO Java SDK. Библиотека используется для того, чтобы:
- Создавать файлы
- Переименовывать файлы
- "Переименовывать" папки. Переименование папки по сути представляет собой создание папки под новым именем и перенос туда файлов
- Удалять файлы

## Upload файлов

Для загрузки файлов используется HTML file input - [https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file). Распространённый подход оформить это в виде зоны, на которую можно перетягивать файлы из проводника, пример - [https://codepen.io/dcode-software/pen/xxwpLQo](https://codepen.io/dcode-software/pen/xxwpLQo).

На уровне HTTP, передача файлов осуществляется с помощью `multipart/form-data`.

Со стороны Spring Boot реализован контроллер для обработки загруженных файлов. Лимит на загрузку файлов в Spring Boot равен 10 мегабайтам.

### Загрузка папок

Раздел в разработке

## Тесты

Раздел в разработке

### Интеграционные тесты сервиса по работе с пользователями

Раздел в разработке

### Интеграционные тесты сервиса по работе с файлами и папками

Раздел в разработке 

## Docker

Используется для запуска сервисов: PostgreSQL, MinIO, Redis. Для работы приложения запускается весь стек контейнеров через Docker Compose

## Деплой

Раздел в разработке
